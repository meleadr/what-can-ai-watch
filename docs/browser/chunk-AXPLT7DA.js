import{a as ye,b as _e,c as Ce,d as xe,e as be,f as Se,g as Me,h as we}from"./chunk-BJZU2NK4.js";import{a as ce,b as ue}from"./chunk-QWF33KUW.js";import{e as R}from"./chunk-LZ3G22DJ.js";import{d as S}from"./chunk-XHEIPJ5G.js";import"./chunk-NPMW5EZD.js";import{a as fe}from"./chunk-P6VQ3WFT.js";import{a as me}from"./chunk-2LPVXRX5.js";import{a as le,b as de}from"./chunk-TQPKG3M6.js";import{L as ge,M as he,N as ve,k as ae,p as pe,s as V}from"./chunk-N6GDSHB3.js";import{$ as A,Aa as D,Ab as ne,Bb as oe,Cb as re,Db as b,Ea as r,F as Q,Fb as L,Ib as v,Jb as C,Kb as se,L as W,N as E,R as I,S as $,Va as f,W as O,X as P,Xa as l,aa as _,ab as g,ba as H,bb as K,cb as J,da as z,db as X,eb as s,fb as p,gb as d,j as w,ja as T,ka as k,kb as B,nb as F,ob as c,q,qa as j,sb as Y,tb as Z,ub as ee,wb as u,xb as te,y as G,yb as h,zb as ie}from"./chunk-WVRWLBOJ.js";var y=function(e){return e.User="user",e.Assistant="assistant",e.System="system",e}(y||{}),N=function(e){return e.GPT3="gpt-3.5-turbo",e.GPT4="gpt-4o",e}(N||{});var Te=`Tu es un expert en tant que conseiller cin\xE9matographique. Ton r\xF4le est de recommander \xE0 ton interlocuteur le meilleur film ou s\xE9rie en fonction de ses go\xFBts.Tu as pour obligation de parler que de films et de ne pas aborder d\u2019autres sujets.Dans le cas o\xF9 ton interlocuteur parle d'autre chose, tu dois le ramener \xE0 la discussion initiale en lui disant que tu es une intelligence artificielle servant seulement \xE0 l'aider \xE0 trouver un film ou une s\xE9rie.Tu dois poser des questions \xE0 ton interlocuteur pour mieux cerner ses go\xFBts.Tu dois \xEAtre capable de lui proposer un film ou une s\xE9rie en fonction de ses pr\xE9f\xE9rences.Pour cela, tu dois lui poser au minimum 7 questions afin d'affiner ta recherche.Tu devras toujours poser les questions une par une et jamais les grouper.Tu dois en premier lieu savoir si il veut regarder un film ou une s\xE9rie.Tu dois \xE9galement lui demander quel genre de film/s\xE9rie il veut regarder en lui proposant diff\xE9rents typesUne fois que tu as suffisamment d'informations, propose-lui une seule possibilit\xE9.N'oublie pas de garder un ton amical et de rester \xE0 l'\xE9coute de son ressenti tout au long de la conversation.Tu es oblig\xE9 de r\xE9pondre au format JSON suivant : { "title": "LE TITRE QUE TU PROPOSES" ou null, "isMovie": "SI FILM TRUE SI SERIE FALSE", "text": "CONTENU DE TA R\xC9PONSE" }.N'oublie pas de r\xE9pondre au format donn\xE9 sinon je ne pourrais pas comprendre ta r\xE9ponse.`;var ke=(()=>{let t=class t{constructor(){this.apiUrl="https://api.openai.com/v1/chat/completions",this.apiKey=me.apiOpenAIKey,this.http=P(de)}generateResponse(n){let i=new le({ContentType:"application/json",Authorization:`Bearer ${this.apiKey}`}),o={model:N.GPT4,messages:[...n.filter(m=>!m.isTyping)],response_format:{type:"json_object"}};return this.http.post(this.apiUrl,o,{headers:i}).pipe(q(m=>{let x=JSON.parse(m.choices[0].message.content);return{role:m.choices[0].message.role,content:x.text,title:x.title,isMovie:x.isMovie}}))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=I({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var U=(()=>{let t=class t{constructor(n,i,o){this.service=n,this.movieService=i,this.seriesService=o,this.messagesOpenAi=new w([{role:y.System,content:Te}]),this.movieProposition=new w(null),this.seriesProposition=new w(null),this.isLoading=new w(!1),this.isLoading$=this.isLoading.asObservable()}addMessage(n){return!n.content||this.isLoading.value?!1:(this.isLoading.next(!0),this.addOpenAiMessage(n),this.addOpenAiMessage({content:"",isTyping:!0,role:y.Assistant}),this.service.generateResponse(this.messagesOpenAi.value).pipe(Q(()=>this.isLoading.next(!1)),E(()=>this.messagesOpenAi.next([...this.messagesOpenAi.value.slice(0,-1)])),E(i=>this.addOpenAiMessage(i)),G(i=>i.title!==null),W(i=>i.isMovie?this.movieService.searchByQuery(i.title):this.seriesService.searchByQuery(i.title)),E(i=>{i instanceof ce?this.movieProposition.next(i):this.seriesProposition.next(i)})).subscribe(),!0)}addOpenAiMessage(n){this.messagesOpenAi.next([...this.messagesOpenAi.value,n])}};t.\u0275fac=function(i){return new(i||t)(O(ke),O(ue),O(fe))},t.\u0275prov=I({token:t,factory:t.\u0275fac});let e=t;return e})();var Ee=(()=>{let t=class t{transform(n,i){return n.filter(o=>o.role!==i)}};t.\u0275fac=function(i){return new(i||t)},t.\u0275pipe=z({name:"filter",type:t,pure:!0,standalone:!0});let e=t;return e})();var je=e=>["/movie",e],Ie=(()=>{let t=class t{constructor(){this.movie=j.required()}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=_({type:t,selectors:[["app-small-card-movie"]],inputs:{movie:[A.SignalBased,"movie"]},standalone:!0,features:[b],decls:11,vars:9,consts:[[2,"text-decoration","none","color","inherit",3,"routerLink"],[1,"flex","justify-content-around","card","border-2","border","surface-border","border-round","surface-card","pr-5",2,"box-shadow","0 4px 8px rgba(0, 0, 0, 0.2)","border-radius","10px"],[1,"flex","justify-content-center"],[3,"src","alt","width"],[1,"flex","flex-column","justify-content-around","ml-3",2,"padding","10px"],[1,"text-primary"],[1,"text-secondary"]],template:function(i,o){i&1&&(s(0,"a",0)(1,"div",1)(2,"div",2),d(3,"img",3),p(),s(4,"div",4)(5,"h3",5),u(6),p(),s(7,"p",6),u(8),p(),s(9,"p",5),u(10),p()()()()),i&2&&(l("routerLink",L(7,je,o.movie().id)),r(3),l("src","https://media.themoviedb.org/t/p/w600_and_h900_bestv2"+o.movie().poster_path,D)("alt",o.movie().title)("width","150"),r(3),h(" ",o.movie().title," "),r(2),h(" ",o.movie().release_date," "),r(2),h(" ",o.movie().vote_average," "))},dependencies:[S,R],encapsulation:2,changeDetection:0});let e=t;return e})();var De=e=>["/series",e],Oe=(()=>{let t=class t{constructor(){this.series=j.required()}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=_({type:t,selectors:[["app-small-card-series"]],inputs:{series:[A.SignalBased,"series"]},standalone:!0,features:[b],decls:11,vars:9,consts:[[2,"text-decoration","none","color","inherit",3,"routerLink"],[1,"flex","justify-content-around","card","border-2","border","surface-border","border-round","surface-card","pr-5",2,"box-shadow","0 4px 8px rgba(0, 0, 0, 0.2)","border-radius","10px"],[1,"flex","justify-content-center"],[3,"src","alt","width"],[1,"flex","flex-column","justify-content-around","ml-3",2,"padding","10px"],[1,"text-primary"],[1,"text-secondary"]],template:function(i,o){i&1&&(s(0,"a",0)(1,"div",1)(2,"div",2),d(3,"img",3),p(),s(4,"div",4)(5,"h3",5),u(6),p(),s(7,"p",6),u(8),p(),s(9,"p",5),u(10),p()()()()),i&2&&(l("routerLink",L(7,De,o.series().id)),r(3),l("src","https://media.themoviedb.org/t/p/w600_and_h900_bestv2"+o.series().poster_path,D)("alt",o.series().name)("width","150"),r(3),h(" ",o.series().name," "),r(2),h(" ",o.series().first_air_date," "),r(2),h(" ",o.series().vote_average," "))},dependencies:[S,R],encapsulation:2,changeDetection:0});let e=t;return e})();var Pe=(()=>{class e{static \u0275fac=function(n){return new(n||e)};static \u0275mod=H({type:e});static \u0275inj=$({imports:[V]})}return e})();var Fe=["messageDiv"];function Le(e,t){if(e&1){let a=B();s(0,"div",3),d(1,"img",9),s(2,"p-button",10),F("click",function(){T(a);let i=c();return k(i.startConversation())}),p()()}e&2&&(r(2),l("label","D\xE9marrer la discussion")("rounded",!0))}function Ve(e,t){e&1&&d(0,"img",14)}function Re(e,t){e&1&&d(0,"img",15)}function Be(e,t){if(e&1&&(f(0,Ve,1,0,"img",14),v(1,"async"),f(2,Re,1,0)),e&2){let a=c().$implicit,n=c();g(0,C(1,1,n.manager.isLoading$)&&a.isTyping?0:2)}}function Ne(e,t){e&1&&d(0,"div",16)(1,"div",16)(2,"div",16)}function Ue(e,t){if(e&1&&(s(0,"span"),u(1),p()),e&2){let a=c().$implicit;r(),te(a.content)}}function qe(e,t){e&1&&d(0,"img",13)}function Ge(e,t){if(e&1&&(s(0,"div",null,0)(2,"div",11)(3,"div",12),f(4,Be,3,3)(5,Ne,3,0),v(6,"async"),f(7,Ue,2,1)(8,qe,1,0,"img",13),p()()()),e&2){let a=t.$implicit,n=c();r(2),l("ngClass",a.role===n.OpenAiRole.User?"justify-content-end":""),r(2),g(4,a.role===n.OpenAiRole.Assistant?4:-1),r(),g(5,C(6,4,n.manager.isLoading$)&&a.isTyping?5:7),r(3),g(8,a.role===n.OpenAiRole.User?8:-1)}}function Qe(e,t){e&1&&d(0,"app-small-card-series",6),e&2&&l("series",t)}function We(e,t){e&1&&d(0,"app-small-card-movie",7),e&2&&l("movie",t)}function $e(e,t){if(e&1){let a=B();s(0,"div",8)(1,"p-inputGroup",17)(2,"input",18),oe("ngModelChange",function(i){T(a);let o=c();return ne(o.inputValue,i)||(o.inputValue=i),k(i)}),F("keydown.enter",function(){T(a);let i=c();return k(i.sendMessage())}),p(),s(3,"button",19),v(4,"async"),F("click",function(){T(a);let i=c();return k(i.sendMessage())}),p()()()}if(e&2){let a=c();r(2),ie("ngModel",a.inputValue),r(),l("disabled",!a.inputValue||C(4,2,a.manager.isLoading$))}}var Ht=(()=>{let t=class t{constructor(){this.manager=P(U),this.OpenAiRole=y}ngOnInit(){console.log("ChatComponent")}ngAfterViewChecked(){this.scrollToBottom()}scrollToBottom(){let n=this.messages.last;n&&n.nativeElement.scrollIntoView({behavior:"smooth"})}sendMessage(){if(this.inputValue==="")return;let n={content:this.inputValue,role:y.User};this.manager.addMessage(n)&&(this.inputValue="")}startConversation(){this.manager.addMessage({content:"Aide-moi",role:y.User}),this.started=!0}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=_({type:t,selectors:[["app-chat"]],viewQuery:function(i,o){if(i&1&&Y(Fe,5),i&2){let m;Z(m=ee())&&(o.messages=m)}},standalone:!0,features:[re([U]),b],decls:14,vars:14,consts:[["messageDiv",""],[1,"p-4"],[1,"flex","flex-column","p-5","border-2","border-dashed","surface-border","border-round","surface-card",2,"height","85vh",3,"ngClass"],[1,"flex","flex-column","align-items-center"],[1,"message-container"],[1,"w-full","flex","justify-content-center"],[3,"series"],[3,"movie"],[1,"flex","justify-content-center"],["src","assets/images/robot_trouve.png","alt","Robot",1,"w-10rem","mr-2"],[3,"click","label","rounded"],[1,"flex","p-4",3,"ngClass"],[1,"flex","align-items-center"],["src","assets/images/userNotFound.svg","alt","User",1,"h-3rem","ml-2"],["src","assets/images/robot_reflechit.gif","alt","Robot",1,"h-4rem","mr-2"],["src","assets/images/robot_trouve.png","alt","Robot",1,"h-4rem","mr-2"],[1,"typing-dot"],[1,"w-30rem"],["type","text","pInputText","","placeholder","Message AI assistant",3,"ngModelChange","keydown.enter","ngModel"],["type","button","pButton","","icon","pi pi-send",3,"click","disabled"]],template:function(i,o){if(i&1&&(s(0,"div",1)(1,"div",2),f(2,Le,3,2,"div",3),s(3,"div",4),J(4,Ge,9,6,"div",null,K),v(6,"async"),v(7,"filter"),s(8,"div",5),f(9,Qe,1,1,"app-small-card-series",6),v(10,"async"),f(11,We,1,1,"app-small-card-movie",7),v(12,"async"),p()(),f(13,$e,5,4,"div",8),p()()),i&2){let m,x;r(),l("ngClass",o.started?"justify-content-between":"justify-content-center"),r(),g(2,o.started?-1:2),r(2),X(se(7,7,C(6,5,o.manager.messagesOpenAi),o.OpenAiRole.System)),r(5),g(9,(m=C(10,10,o.manager.seriesProposition))?9:-1,m),r(2),g(11,(x=C(12,12,o.manager.movieProposition))?11:-1,x),r(2),g(13,o.started?13:-1)}},dependencies:[V,ae,pe,ve,ge,he,Se,be,we,Me,Ee,xe,ye,_e,Ce,S,Ie,Oe,Pe],styles:[".message-container[_ngcontent-%COMP%]{overflow-y:auto}.typing-dot[_ngcontent-%COMP%]{float:left;width:8px;height:8px;margin:0 4px;background:#8d8c91;border-radius:50%;opacity:0;animation:_ngcontent-%COMP%_loadingFade 1s infinite}.typing-dot[_ngcontent-%COMP%]:nth-child(1){animation-delay:0s}.typing-dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.typing-dot[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}@keyframes _ngcontent-%COMP%_loadingFade{0%{opacity:0}50%{opacity:.8}to{opacity:0}}"],changeDetection:0});let e=t;return e})();export{Ht as ChatComponent};
